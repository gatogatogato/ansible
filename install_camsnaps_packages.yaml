---
- hosts: camsnaps
  gather_facts: yes
  become: yes
  name: "Install stuff on web servers"
  tasks:
    - name: "Install a list of apt packages"
      ansible.builtin.apt:
        pkg:
        - apache2
        - imagemagick
        - libimage-exiftool-perl

    - name: "Enable the apache2 module rewrite"
      community.general.apache2_module:
        state: present
        name: rewrite

    - name: "Enable the apache2 module ssl"
      community.general.apache2_module:
        state: present
        name: ssl
    
    - name: Create directory
      ansible.builtin.file:
        path: /var/www/html/snapshots
        state: directory
        owner: root
        group: root
        mode: 0775

    - name: Add transport to group root
      ansible.builtin.user:
        name: transport
        groups: root
        append: yes

    - name: "transport cronjob for backups"
      ansible.builtin.cron:
        user: transport
        name: "Copy files"
        minute: "*/30"
        job: scp -q root@homeassistant.lan:"/root/config/www/*.jpg"  /var/www/html/snapshots